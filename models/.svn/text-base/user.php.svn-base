<?php
/* SVN FILE:  $Id$ */
/**
 * Short description for file.
 *
 * Long description for file
 *
 * PHP versions 5
 *
 * Licensed under The BSD License
 * Redistributions of files must retain the above copyright notice.
 *
 * @filesource
 * @copyright     Copyright 2007-2009, Felix Ding (http://dingyu.me)
 * @link          http://lonelythinker.org Project LonelyThinker
 * @package       LonelyThinker
 * @author		  $LastChangedBy$
 * @version       $Revision$
 * @modifiedby    $LastChangedBy$
 * @lastmodified  $Date$
 * @license       http://www.opensource.org/licenses/bsd-license.php The BSD License
 */
class User extends AppModel
{
    var $name = 'User';
    var $hasMany = array('Post');
    var $belongsTo = 'Group';
	var $validate = array(
        'name' => array('rule'=>'notEmpty', 'message'=>'You forgot the name'),
        'email' => array(
        	'email'=>array('rule'=>'email', 'message'=>"Make sure you have input an valid email address"),
        	'isUnique'=>array('rule'=>'isUnique', 'message'=>"This email address is already in use, please try another")
        	),
        'passwd' => array(
        	'required' => array('rule'=>array('custom', '/[a-zA-Z0-9\_\-]{6,}$/i'), 'message'=>'Must be 6 characters or longer'),
        	'length' => array('rule'=>'validatePassword', 'message'=>"Your passwords dont match!")
		)     
    );
    
    /**
     * custom validation rules
     *
     * courtesy of http://edwardawebb.com/programming/php-programming/cakephp/complex-validation-cakephp-12
     */
    public function validatePassword()
    {
		$passed = true;
		
		//only run if there are two password feield (like NOT on the contact or signin pages..)
		if(isset($this->data['User']['confirmpassword']))
		{
			if($this->data['User']['passwd'] != $this->data['User']['confirmpassword'])
			{
				$this->invalidate('passwd');
				
				//they didnt condifrm password
				$passed = false;
			}
			else
			{
				//hash password before saving
				$this->data['User']['passwd']=md5($this->data['User']['passwd']);
			}
		}

		return $passed;
	}
}
?>